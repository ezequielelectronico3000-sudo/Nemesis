{% set code_id = loop.index0 if loop is defined else 'html' %}

{% set file_url = css.url if css is defined else js.url if js is defined else 'Código HTML completo' %}
{% set title_prefix = 'Archivo CSS:' if css is defined else 'Archivo JS:' if js is defined else 'Código HTML completo:' %}

{% set download_name %}
    {% if css is defined %}
        {{ css.nombre_descarga }}
    {% elif js is defined %}
        {{ js.nombre_descarga }}
    {% else %}
        index.html
    {% endif %}
{% endset %}

<div class="header-with-copy" style="position: relative;">
    
    <h3>
        {{ title_prefix }}
        <span id="file-url-{{ code_id }}">{{ file_url }}</span>
    </h3>

    {% if file_url != 'Código HTML completo:' %}
        <button 
            class="copy-button" 
            onclick="copyToClipboard('file-url-{{ code_id }}', this)" 
            title="Copiar Enlace Completo"
            style="
                position: absolute; 
                top: 5px; 
                right: 0; 
                padding: 5px; 
                background: none; 
                border: none; 
                color: #ff5757;
                cursor: pointer;
                font-size: 1.2em;
            "
        >
            📄
        </button>
    {% endif %}

</div>


<div id="html-content-{{ code_id }}" style="max-height: 300px; overflow: hidden; position: relative;">
    <pre><code class="code-{{ code_id }}" id="code-content-{{ code_id }}">
        {{ css.contenido if css is defined else js.contenido if js is defined else resultados.html_completo }}
    </code></pre>
    
    <div id="fade-overlay-{{ code_id }}" style="
        position: absolute; 
        bottom: 0; 
        left: 0; 
        width: 100%; 
        height: 80px; 
        background: linear-gradient(to top, #1a1a2e, rgba(26, 26, 46, 0)); 
    "></div>
</div>

<div style="text-align: center; margin-top: 15px; display: flex; justify-content: center; gap: 15px;">
    
    <button type="button" onclick="toggleHtml('{{ code_id }}')" id="toggle-button-{{ code_id }}">
        Mostrar Completo
    </button>
    
    {% if code_id == 'html' %}
        <button 
            type="button" 
            onclick="toggleInsights('{{ code_id }}')" 
            id="insight-button-{{ code_id }}"
            style="
                background: linear-gradient(to right, #66ccff, #3399ff); /* Un color diferente */
                color: #1a1a2e; 
                font-weight: bold; 
                border: none; 
                cursor: pointer; 
                padding: 15px 25px; 
                border-radius: 5px;
            "
        >
            Mostrar Insights
        </button>
    {% endif %}
    
    <button 
        type="button" 
        onclick="downloadCode('code-content-{{ code_id }}', '{{ download_name | trim }}')"
        style="background: linear-gradient(to right, #9999ff, #6666ff); color: #1a1a2e; font-weight: bold; border: none; cursor: pointer; padding: 15px 25px; border-radius: 5px;"
    >
        Descargar Código (
        {% if css is defined %}
            {{ css.nombre_corto }}
        {% elif js is defined %}
            {{ js.nombre_corto }}
        {% else %}
            index.html
        {% endif %}
        )
    </button>
  </div>
